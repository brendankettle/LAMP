# LAMP Documentation (in progress)
<!--- https://www.markdownguide.org/ --->

## Aim/Ethos
The main goal of LAMP is to provide a framework for processing data from laser-plasma experiments at different laser facilities. 
Reusable diagnostic code and scripts that can be quickly implemented with a bit of know how. 
This works by using an abstraction layer for accessing data, with a different DAQ module depending on the facility in question. 
Each diagnostic module works through this DAQ system, but also make use of shared libaries and utlities for common processing steps like background subtraction, spatial transforms, etc.
You specify the unique properties of any diagnostics on any given experiment using calibration input decks, that are for the most part, human readable/writable.
With the above in place, short, simple and reusable scripts are the entry way for analysing experimental data, calling on LAMP functionality where needs be.

## Getting Started

### Installation

As LAMP is still currently under heavy development, it has not been packaged and so "installation" is currently a bit rough and ready.

My (BK) recommendation currently is to follow these steps:
- Download something like GitHub desktop to manage the different experiment and LAMP repositories on your computer, and to push/pull updates. If you don't know how to use git, I would recommend googling some tutorials.
- Download a local copy of the experiment repository.
- Download a local copy of the LAMP repository to INSIDE this experiment folder. If you are working on multiple experiments, it helps to create an alias for each LAMP copy.
- Make sure you push/pull all updates before and after working on the experiments or LAMP.

Note that currently I am not expecting anybody to setup an experiment repository, I (BK) can do that. Please ask if you need help with this.

Requirements (at least):
- toml
- opencv

### An example script

...

A few script writing concepts:

- **Shot dictionaries** are how you define which data to analysis and how you interact with the DAQ. 
The format can be unique to the DAQ inquestions. 
Crucially, the diagnostics code should not depend on the specifics of the shot dictionaries, but rather always interact through the DAQ.
- **Experiment Object**
- **Diagnostic Object**

### Configuring diagnostics and experiment details:

- **Calibrations** are key to setting up diagnostics. Like an input deck for the specific experiment setup. It is split into named blocks that indicate when the calibration should be applied. Some will have processed data in a seperate file, usually generated by a make_calib() function.
- **DAQs**


## Starting a new experiment

(NOTE: This should already be done within an experiment repository, most people won't have to do this. If you need help, ask BK, but normally I have set all this up)

1.	Decide on your folder structure. Examples are (will be) given in /templates/.
2.	Create a config file. The minimum required information is the DAQ name (see list of DAQs later) in a setup section, and the path to the data folder in paths section.

```
[setup]
DAQ = GeminiMirage
[paths]
data_folder = /Some/Path/To/All/Experiment/Data/
```

3.	Add a diagnostic to the diagnostic config file. The minimum required information is the name, the diagnostic module (type), and the data folder (contained in the root data folder).

```
[setup]
name = ESpecHigh
type = ESpec
data_folder = ./ESpec/
```

4.	Create a script. This will start by initiating the experiment using a root folder which points to LAMP, and passing an experiment config file.

## Diagnostics

### ESpec

Description of diagnostic workings. Including diagrams. Calibration input definitions

### XAS

...

## Developing LAMP

General writing guidelines
- For functions in the DAQ / Diagnostic layers, try to keep named arguments? 
- Keep specific actions as separate subfunctions as to future proof the code or centralise changes in structure / formatting.

Writing a new diagnostic

General writing specifications
Should interface to the DAQ through the following functions:
- get_shot_data(diagnostic_name, shot_dictionary)
- get_shot_info?
- Calibration inputs should, where possible be written in JSON so that they are human readable?
- Calibration outputs should be saved as .pkl files where it is large data (arrays or images), or JSON files if it is single values?
- Results should be saved as .pkl files?

Writing a new DAQ interface
Required function calls
- get_shot_data(diagnostic_name, shot_dictionary)
- get_shot_info?

... Writing a new Meta interface

